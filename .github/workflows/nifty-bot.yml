name: Nifty Options Trading Bot

on:
  workflow_dispatch:   # Manual trigger

jobs:
  trade:
    runs-on: ubuntu-latest
    
    steps:
    # Checkout your code
    - name: Checkout code
      uses: actions/checkout@v4   # âœ… Updated version
    
    # Set up Python
    - name: Set up Python
      uses: actions/setup-python@v5   # âœ… Updated version
      with:
        python-version: '3.11'
    
    # Install dependencies
    - name: Install dependencies
      run: pip install -r requirements.txt
    
    # Display current time in IST
    - name: Display IST time
      run: |
        echo "ðŸ•’ IST Time:"
        TZ='Asia/Kolkata' date
    
    # Run your trading bot in unbuffered mode so all logs show up
    - name: Run trading bot (unbuffered mode)
      run: python -u main.py    # âœ… '-u' ensures unbuffered stdout for live logs
      env:
        PYTHONUNBUFFERED: '1'
      timeout-minutes: 390      # ~6.5 hours (market hours)
    
    # Upload full logs + trades after completion or failure
    - name: Upload run artifacts
      if: always()              # âœ… ensures even on failure logs get uploaded
      uses: actions/upload-artifact@v4   # âœ… Latest version
      with:
        name: nifty-bot-run-${{ github.run_number }}
        path: nifty_bot_runs/**           # âœ… Uploads all folders & log files
        retention-days: 30                # Keep logs for 30 days

    # Optional: Also upload bot.log separately for quick access
    - name: Upload main bot.log
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: bot-log-${{ github.run_number }}
        path: nifty_bot_runs/**/log_reports/bot.log
        retention-days: 30
